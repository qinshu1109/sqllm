# Sub2API 公网访问配置指南

## 当前状态
- ✅ Sub2API 服务运行中（PID: 2084）
- ✅ 监听地址: 0.0.0.0:8080
- ✅ WSL IP: 172.25.145.145

## 配置步骤

### 方法一：使用自动化脚本（推荐）

1. **在 Windows 中打开 PowerShell（管理员）**
   - 按 `Win + X`，选择"Windows PowerShell (管理员)"或"终端（管理员）"

2. **运行配置脚本**
   ```powershell
   # 脚本会自动配置端口转发和防火墙
   # 使用下面的命令查看Windows路径
   wsl wslpath -w /home/qinshu/sub2api/setup-port-forward.ps1

   # 然后运行该脚本
   # 示例: & "\\wsl$\Ubuntu\home\qinshu\sub2api\setup-port-forward.ps1"
   ```

### 方法二：手动配置

在 **Windows PowerShell（管理员）** 中执行：

```powershell
# 1. 添加端口转发规则
netsh interface portproxy add v4tov4 listenport=8080 listenaddress=0.0.0.0 connectport=8080 connectaddress=172.25.145.145

# 2. 配置防火墙
netsh advfirewall firewall add rule name="WSL2 Sub2API" dir=in action=allow protocol=TCP localport=8080

# 3. 验证配置
netsh interface portproxy show all
```

### 方法三：使用 socat 转发（WSL内部方案）

如果不想配置Windows端口转发，可以在WSL中使用socat：

```bash
# 安装 socat
sudo apt update && sudo apt install -y socat

# 后台运行端口转发（需要找到公网IP或配置NAT）
# 注意：这个方法在WSL2中通常不能直接暴露到公网
```

## 获取访问地址

### 1. 获取 Windows 主机 IP

在 Windows PowerShell 中执行：
```powershell
ipconfig
```

查找 "以太网适配器" 或 "无线局域网适配器" 的 IPv4 地址

### 2. 访问地址

配置完成后，可以通过以下地址访问：

- **本地访问**: `http://localhost:8080`
- **局域网访问**: `http://Windows主机IP:8080`
- **公网访问**: 需要在路由器配置端口映射，将外网的某端口映射到 `Windows主机IP:8080`

## 验证访问

```bash
# 在 WSL 中测试
curl --noproxy "*" http://localhost:8080

# 在 Windows 中测试
# 打开浏览器访问 http://localhost:8080
```

## 故障排查

### 1. 检查服务运行状态
```bash
ps aux | grep sub2api
```

### 2. 检查端口监听
```bash
sudo ss -tlnp | grep 8080
```

### 3. 查看端口转发规则（Windows PowerShell）
```powershell
netsh interface portproxy show all
```

### 4. 删除端口转发规则（如需重新配置）
```powershell
netsh interface portproxy delete v4tov4 listenport=8080 listenaddress=0.0.0.0
netsh advfirewall firewall delete rule name="WSL2 Sub2API"
```

## 云服务器部署

如果你想要真正的公网访问，建议：

1. **使用云服务器**（阿里云、腾讯云、AWS等）
2. **使用内网穿透服务**（frp、ngrok、Cloudflare Tunnel等）
3. **Docker部署**：在有公网IP的服务器上使用 docker-compose 部署

## 默认登录信息

- 邮箱: `admin@sub2api.com`
- 密码: `admin123`

---

如有问题，请检查：
1. Windows 防火墙设置
2. 路由器防火墙设置
3. WSL2 网络配置
4. Sub2API 服务日志
